using System.Collections.Generic;
using NUnit.Framework;
using UpDock.Versioning;

namespace UpDock.Tests
{
    public class VersionNumberRangeTests
    {
        [TestCase("* || >=2", "0.0.0")]
        [TestCase("*", "0.0.0")]
        [TestCase("*", "1.2.3")]
        [TestCase("*-*", "1.0.0-rc1")]
        [TestCase("*-*", "1.2.3-foo")]
        [TestCase("^0.0.1", "0.0.1")]
        [TestCase("^0.0.1-alpha", "0.0.1")]
        [TestCase("^0.0.1-alpha", "0.0.1-beta")]
        [TestCase("^0.1", "0.1.2")]
        [TestCase("^0.1.0 || ~3.0.1 || 5.0.0-*", "5.0.0-0")]
        [TestCase("^0.1.1-alpha", "0.1.1-beta")]
        [TestCase("^0.1.2", "0.1.2")]
        [TestCase("^1.0.0-*", "1.0.1-rc1")]
        [TestCase("^1.0.0-*", "1.1.0-rc1")]
        [TestCase("^1.0.0-0", "1.0.1-rc1")]
        [TestCase("^1.0.0-alpha", "1.0.0-beta")]
        [TestCase("^1.0.0-rc2", "1.0.1-rc1")]
        [TestCase("^1.1.1 || >=2", "1.1.1")]
        [TestCase("^1.1.1", "1.1.1")]
        [TestCase("^1.1.1-beta", "1.1.1-beta")]
        [TestCase("^1.2 ^1", "1.4.2")]
        [TestCase("^1.2", "1.4.2")]
        [TestCase("^1.2.0-alpha", "1.2.0-pre")]
        [TestCase("^1.2.3", "1.8.1")]
        [TestCase("^1.2.3+build", "1.2.3")]
        [TestCase("^1.2.3+build", "1.3.0")]
        [TestCase("^1.2.3-alpha", "1.2.3-pre")]
        [TestCase("^2.16.2 ^2.16", "2.16.2")]
        [TestCase("^x", "1.2.3")]
        [TestCase("~>1", "1.2.3")]
        [TestCase("~>3.2.1", "3.2.2")]
        [TestCase("~0.0.1", "0.0.1")]
        [TestCase("~0.0.1", "0.0.2")]
        [TestCase("~0.5.4-pre", "0.5.4")]
        [TestCase("~0.5.4-pre", "0.5.5")]
        [TestCase("~0.6.1-1", "0.6.1-1")]
        [TestCase("~1", "1.2.3")]
        [TestCase("~1.0", "1.0.2")]
        [TestCase("~1.0.0-alpha", "1.0.0-beta")]
        [TestCase("~1.0.3", "1.0.12")]
        [TestCase("~1.1.1 || >=2", "1.1.1")]
        [TestCase("~1.1.1", "1.1.1")]
        [TestCase("~1.1.1-beta", "1.1.1-beta")]
        [TestCase("~1.2.1 =1.2.3", "1.2.3")]
        [TestCase("~1.2.1 >=1.2.3 1.2.3", "1.2.3")]
        [TestCase("~1.2.1 >=1.2.3", "1.2.3")]
        [TestCase("~1.2.1 1.2.3 >=1.2.3", "1.2.3")]
        [TestCase("~1.2.1 1.2.3", "1.2.3")]
        [TestCase("~1.2.3", "1.2.3")]
        [TestCase("~1.2.3", "1.2.4")]
        [TestCase("~1.2.3", "1.2.5")]
        [TestCase("~1.2.3", "1.2.6")]
        [TestCase("~2", "2.0.9")]
        [TestCase("~2.4", "2.4.0")]
        [TestCase("~2.4", "2.4.5")]
        [TestCase("~x", "0.0.9")]
        [TestCase("<=0.7.x", "0.6.2")]
        [TestCase("<=0.7.x", "0.7.2")]
        [TestCase("<=0.7.x-*", "0.7.0-asdf")]
        [TestCase("<=2 || >=4", "0.0.0")]
        [TestCase("<=2.0.0", "0.2.9")]
        [TestCase("<=2.0.0", "1.9999.9999")]
        [TestCase("<=2.0.0", "2.0.0")]
        [TestCase("<=7.x", "7.9.9")]
        [TestCase("<0.0.0-beta >0.0.0-alpha", "0.0.0-alpha.0")]
        [TestCase("<0.0.0-beta", "0.0.0-0")]
        [TestCase("<0.0.1-beta", "0.0.0")]
        [TestCase("<1.2", "1.1.1")]
        [TestCase("<2 || >4", "0.0.0")]
        [TestCase("<2", "0.0.0")]
        [TestCase("<2.0.0", "0.2.9")]
        [TestCase("<2.0.0", "1.9999.9999")]
        [TestCase("=0.7.x", "0.7.2")]
        [TestCase("=0.7.x-*", "0.7.0-asdf")]
        [TestCase("=1.0.0", "1.0.0")]
        [TestCase(">=*", "0.2.4")]
        [TestCase(">=0.1.97", "0.1.97")]
        [TestCase(">=0.2.3 || <0.0.1", "0.0.0")]
        [TestCase(">=0.2.3 || <0.0.1", "0.2.3")]
        [TestCase(">=0.2.3 || <0.0.1", "0.2.4")]
        [TestCase(">=0.2.3 <=0.2.4", "0.2.3")]
        [TestCase(">=0.2.3 <=0.2.4", "0.2.4")]
        [TestCase(">=0.7.x", "0.7.2")]
        [TestCase(">=0.7.x-*", "0.7.0-asdf")]
        [TestCase(">=1", "1.0.0")]
        [TestCase(">=1.0.0", "1.0.0")]
        [TestCase(">=1.0.0", "1.0.1")]
        [TestCase(">=1.0.0", "1.1.0")]
        [TestCase(">=1.0.0-* <=1.1.0-*", "1.1.0-pre")]
        [TestCase(">=1.0.0-alpha", "1.0.0-alpha.1")]
        [TestCase(">=1.0.0-alpha.1", "1.0.0-alpha.beta")]
        [TestCase(">=1.0.0-alpha.beta", "1.0.0-beta")]
        [TestCase(">=1.0.0-beta", "1.0.0-beta.2")]
        [TestCase(">=1.0.0-beta.11", "1.0.0-rc.1")]
        [TestCase(">=1.0.0-beta.2", "1.0.0-beta.11")]
        [TestCase(">=1.0.0-rc.1", "1.0.0")]
        [TestCase(">=1.1.1 <2 || >=2.2.2 <2", "1.1.1")]
        [TestCase(">=1.2", "1.2.8")]
        [TestCase(">=1.2.1 >=1.2.3", "1.2.3")]
        [TestCase(">=1.2.1 1.2.3", "1.2.3")]
        [TestCase(">=1.2.3 >=1.2.1", "1.2.3")]
        [TestCase(">=2 || *", "0.0.0")]
        [TestCase(">=2.2.2 <2 || >=1.1.1 <2", "1.1.1")]
        [TestCase(">=4 || <=2", "0.0.0")]
        [TestCase(">0.0.0-alpha <0.0.0-beta", "0.0.0-alpha.0")]
        [TestCase(">0.2.3 >0.2.4 <=0.2.5", "0.2.5")]
        [TestCase(">1.0.0", "1.0.1")]
        [TestCase(">1.0.0", "1.1.0")]
        [TestCase(">1.0.0-0", "1.0.0-0.0")]
        [TestCase(">1.0.0-beta", "1.0.0-beta.0")]
        [TestCase(">1.2.3-*", "1.3.0-alpha")]
        [TestCase(">2 || *", "0.0.0")]
        [TestCase(">2 || >1.0.0", "1.0.1")]
        [TestCase(">2 || >1.0.0-0", "1.0.0-0.0")]
        [TestCase(">2 || >1.0.0-beta", "1.0.0-beta.0")]
        [TestCase(">4 || <2", "0.0.0")]
        [TestCase("0.1.20 || 1.2.4", "0.1.20")]
        [TestCase("0.1.20 || 1.2.4", "1.2.4")]
        [TestCase("0.7.x-*", "0.7.2-beta")]
        [TestCase("1", "1.0.0")]
        [TestCase("1-* - 2", "1.0.0-pre")]
        [TestCase("1-* - 2", "2.0.0-pre")]
        [TestCase("1.*", "1.0.0")]
        [TestCase("1.*.x", "1.0.0")]
        [TestCase("1.0", "1.0.0")]
        [TestCase("1.0-* - 2", "1.0.0-pre")]
        [TestCase("1.0.*", "1.0.0")]
        [TestCase("1.0.0 - 2.0.0", "1.2.3")]
        [TestCase("1.0.0 - 2.0.0", "2.0.0")]
        [TestCase("1.0.0 - x", "1.9.7")]
        [TestCase("1.0.0", "1.0.0")]
        [TestCase("1.0.x", "1.0.0")]
        [TestCase("1.1 - 1.8.0", "1.1.0")]
        [TestCase("1.1.1 - 1.8.0", "1.1.1")]
        [TestCase("1.1.x-*", "1.1.0-a")]
        [TestCase("1.1.x-*", "1.1.1-a")]
        [TestCase("1.2", "1.2.3")]
        [TestCase("1.2", "1.2.4")]
        [TestCase("1.2.* || 2.*", "1.2.3")]
        [TestCase("1.2.*", "1.2.3")]
        [TestCase("1.2.3 >=1.2.1", "1.2.3")]
        [TestCase("1.2.3+asdf - 2.4.3+asdf", "1.2.3")]
        [TestCase("1.2.3-pre+asdf - 2.4.3-pre+asdf", "1.2.3")]
        [TestCase("1.2.3-pre+asdf - 2.4.3-pre+asdf", "1.2.3-pre.2")]
        [TestCase("1.2.3-pre+asdf - 2.4.3-pre+asdf", "2.4.3-alpha")]
        [TestCase("1.2.x || 2.x", "1.2.3")]
        [TestCase("1.2.x", "1.2.3")]
        [TestCase("1.x - x", "1.9.7")]
        [TestCase("1.x", "1.0.0")]
        [TestCase("1.x.*", "1.0.0")]
        [TestCase("1.x.x", "1.0.0")]
        [TestCase("2", "2.1.2")]
        [TestCase("2.*.*", "2.1.3")]
        [TestCase("2.3", "2.3.1")]
        [TestCase("2.x-*", "2.0.0-pre.0")]
        [TestCase("2.x-*", "2.1.0-pre.0")]
        [TestCase("2.x.x", "2.1.3")]
        [TestCase("x - 1.0.0", "0.9.7")]
        [TestCase("x - 1.x", "0.9.7")]
        [TestCase("x", "1.2.3")]
        public void ShouldSatisfyVersion(string rangeStr, string versionStr)
        {
            var range = VersionNumberRange.Parse(rangeStr);

            var version = VersionNumber.Parse(versionStr);

            Assert.That(range.Satisfies(version), Is.True);
        }

        [TestCase("*", "1.2.3-foo")]
        [TestCase("^0.0.1", "0.0.2")]
        [TestCase("^0.0.1", "0.0.2-alpha")]
        [TestCase("^1", "1.0.0-0")]
        [TestCase("^1.0.0", "1.0.0-rc1")]
        [TestCase("^1.0.0", "2.0.0-rc1")]
        [TestCase("^1.2", "1.1.9")]
        [TestCase("^1.2", "1.2.0-pre")]
        [TestCase("^1.2.3", "1.2.2")]
        [TestCase("^1.2.3", "1.2.3-beta")]
        [TestCase("^1.2.3", "1.2.3-pre")]
        [TestCase("^1.2.3", "2.0.0-alpha")]
        [TestCase("^1.2.3+build", "1.2.0")]
        [TestCase("^1.2.3+build", "2.0.0")]
        [TestCase("^1.2.3-rc2", "2.0.0")]
        [TestCase("~>1", "0.2.3")]
        [TestCase("~>1", "0.2.4")]
        [TestCase("~>1", "2.2.3")]
        [TestCase("~>3.2.1", "2.3.2")]
        [TestCase("~>3.2.1", "3.2.0")]
        [TestCase("~>3.2.1", "3.3.2")]
        [TestCase("~0.0.1", "0.1.0")]
        [TestCase("~0.0.1", "0.1.0-alpha")]
        [TestCase("~0.5.4-beta", "0.5.4-alpha")]
        [TestCase("~0.5.4-pre", "0.5.4-alpha")]
        [TestCase("~0.6.1-1", "0.6.1-0")]
        [TestCase("~1", "0.2.3")]
        [TestCase("~1.0", "0.0.0")]
        [TestCase("~1.0", "0.1.0")]
        [TestCase("~1.0", "0.1.2")]
        [TestCase("~1.0", "1.1.0")]
        [TestCase("~1.2.2", "1.2.1")]
        [TestCase("~2.4", "2.3.0")]
        [TestCase("~2.4", "2.3.5")]
        [TestCase("~2.4", "2.3.9")]
        [TestCase("~2.4", "2.5.0")]
        [TestCase("<=0.7.x", "0.7.0-asdf")]
        [TestCase("<=1.2.3", "1.2.3-beta")]
        [TestCase("<=2.0.0", "2.2.9")]
        [TestCase("<=2.0.0", "2.9999.9999")]
        [TestCase("<=2.0.0", "3.0.0")]
        [TestCase("<0.7.x", "0.7.2")]
        [TestCase("<1", "1.0.0")]
        [TestCase("<1.2.3", "1.2.3-beta")]
        [TestCase("<2.0.0", "2.2.9")]
        [TestCase("<2.0.0", "2.9999.9999")]
        [TestCase("=0.7.x", "0.6.0")]
        [TestCase("=0.7.x", "0.6.0-asdf")]
        [TestCase("=0.7.x", "0.6.2")]
        [TestCase("=0.7.x", "0.7.0-asdf")]
        [TestCase("=0.7.x", "0.8.2")]
        [TestCase("=1.2.3", "1.2.3-beta")]
        [TestCase(">=0.1.97", "0.1.93")]
        [TestCase(">=0.2.3 || <0.0.1", "0.0.3")]
        [TestCase(">=0.2.3 || <0.0.1", "0.2.2")]
        [TestCase(">=0.7.x", "0.6.0")]
        [TestCase(">=0.7.x", "0.6.2")]
        [TestCase(">=0.7.x", "0.7.0-asdf")]
        [TestCase(">=1.0.0 <1.1.0", "1.1.0")]
        [TestCase(">=1.0.0", "0.0.0")]
        [TestCase(">=1.0.0", "0.0.1")]
        [TestCase(">=1.0.0", "0.1.0")]
        [TestCase(">=1.0.0", "1.0.0-rc.1")]
        [TestCase(">=1.0.0-* <1.1.0", "1.1.0-pre")]
        [TestCase(">=1.0.0-* <1.1.0-pre", "1.1.0-pre")]
        [TestCase(">=1.0.0-alpha.1", "1.0.0-alpha")]
        [TestCase(">=1.0.0-alpha.beta", "1.0.0-alpha.1")]
        [TestCase(">=1.0.0-beta", "1.0.0-alpha.beta")]
        [TestCase(">=1.0.0-beta.11", "1.0.0-beta.2")]
        [TestCase(">=1.0.0-beta.2", "1.0.0-beta")]
        [TestCase(">=1.0.0-rc.1", "1.0.0-beta.11")]
        [TestCase(">=1.2", "1.1.1")]
        [TestCase(">=2.0.0", "1.0.0")]
        [TestCase(">=2.0.0", "1.1.1")]
        [TestCase(">=2.0.0", "1.2.9")]
        [TestCase(">=2.0.0", "1.9999.9999")]
        [TestCase(">1", "1.0.0")]
        [TestCase(">1.0.0", "0.0.1")]
        [TestCase(">1.0.0", "0.1.0")]
        [TestCase(">1.2", "1.2.0")]
        [TestCase(">1.2", "1.2.1")]
        [TestCase(">1.2", "1.2.8")]
        [TestCase(">1.2", "1.3.0-beta")]
        [TestCase(">1.2.3", "1.3.0-alpha")]
        [TestCase(">1.2.3-alpha.3", "3.4.5-alpha.9")]
        [TestCase(">2.0.0", "1.2.9")]
        [TestCase(">2.0.0", "2.0.0")]
        [TestCase("0.1.20 || 1.2.4", "0.1.5")]
        [TestCase("0.1.20 || 1.2.4", "1.2.3")]
        [TestCase("1 - 2", "1.0.0-pre")]
        [TestCase("1 - 2", "2.0.0-pre")]
        [TestCase("1.0 - 2", "1.0.0-pre")]
        [TestCase("1.0.0 - 2.0.0", "0.0.1")]
        [TestCase("1.0.0 - 2.0.0", "0.2.3")]
        [TestCase("1.0.0 - 2.0.0", "2.2.3")]
        [TestCase("1.0.0", "0.0.0")]
        [TestCase("1.0.0", "0.0.1")]
        [TestCase("1.0.0", "1.0.1")]
        [TestCase("1.0.0-beta.2", "1.0.0-beta.1")]
        [TestCase("1.1.x", "1.0.0-a")]
        [TestCase("1.1.x", "1.0.0-a")]
        [TestCase("1.1.x", "1.1.0-a")]
        [TestCase("1.1.x", "1.2.0-a")]
        [TestCase("1.1.x", "1.2.0-a")]
        [TestCase("1.2.* || 2.*", "1.1.3")]
        [TestCase("1.2.* || 2.*", "1.1.3")]
        [TestCase("1.2.* || 2.*", "1.1.9999")]
        [TestCase("1.2.* || 2.*", "3.1.3")]
        [TestCase("1.2.*", "1.1.3")]
        [TestCase("1.2.*", "1.3.3")]
        [TestCase("1.2.3+asdf - 2.4.3+asdf", "1.2.3-pre.2")]
        [TestCase("1.2.3+asdf - 2.4.3+asdf", "2.4.3-alpha")]
        [TestCase("1.2.x || 2.x", "1.0.0")]
        [TestCase("1.2.x || 2.x", "1.1.3")]
        [TestCase("1.2.x || 2.x", "1.1.3")]
        [TestCase("1.2.x || 2.x", "3.1.3")]
        [TestCase("1.2.x", "1.1.0")]
        [TestCase("1.2.x", "1.1.3")]
        [TestCase("1.2.x", "1.3.3")]
        [TestCase("1.x-*", "0.0.0-a")]
        [TestCase("1.x", "1.0.0-a")]
        [TestCase("1.x", "1.1.0-a")]
        [TestCase("1.x", "1.2.0-a")]
        [TestCase("1.x-*", "2.0.0-a")]
        [TestCase("2", "1.0.0")]
        [TestCase("2", "1.1.2")]
        [TestCase("2", "1.9999.9999")]
        [TestCase("2.*.*", "1.0.1")]
        [TestCase("2.*.*", "1.1.3")]
        [TestCase("2.*.*", "3.1.3")]
        [TestCase("2.3", "2.2.1")]
        [TestCase("2.3", "2.2.2")]
        [TestCase("2.3", "2.4.1")]
        [TestCase("2.x", "3.0.0-pre.0")]
        [TestCase("2.x.x", "1.0.0")]
        [TestCase("2.x.x", "1.1.3")]
        [TestCase("2.x.x", "3.1.3")]
        public void ShouldNotSatisfyVersion(string rangeStr, string versionStr)
        {
            var range = VersionNumberRange.Parse(rangeStr);

            var version = VersionNumber.Parse(versionStr);

            Assert.That(range.Satisfies(version), Is.False);
        }
    }
}
